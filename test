#!/bin/bash
set -ex

# clean up anything left behind from before:
rm -f .coverage .coverage.*

# See: http://nedbatchelder.com/code/coverage/subprocess.html
# the verbose flag seems to be essential to reproducing my issue.
COVERAGE_PROCESS_START=.coveragerc py.test -vvv -n 200 "$@" ./tests

coverage combine
coverage report --fail-under 100
